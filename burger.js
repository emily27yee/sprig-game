const player = "p"
const meat = "m"
const cheese = "c"
const tomato = "t"
const lettuce = "l"
const topBun = "b"

setLegend(
  [ player, bitmap`
................
................
................
................
................
................
................
................
................
................
..CCCCCCCCCCCC..
...CCCCCCCCCC...
....CCCCCCCC....
................
................
................` ],
  [ meat, bitmap`
................
................
................
................
................
................
...C0CC0CC03C...
..C0CC0CC0CC0C..
..0CC0C30CC0CC..
...C0CC0C30CC...
................
................
................
................
................
................`],
  [ cheese, bitmap`
................
................
................
................
................
.........66.....
.......666666...
.....666666666..
...666666666666.
..66666666666...
....6666666.....
......666.......
................
................
................
................`],
  [ tomato, bitmap`
................
................
................
................
................
................
................
....3333333333..
...332322232333.
...333232323233.
....3333333333..
................
................
................
................
................`],
  [ lettuce, bitmap`
................
................
................
................
.......DF..DD...
...DF.DDDDDD....
..DDDD44D4DDDF..
....FD4D4DD4DF..
..DDDDDDD4DDDD..
...FDD.DDDDD....
.......D..FF....
................
................
................
................
................`],
  [ topBun, bitmap`
................
................
................
.....CCCC2C.....
....CC6C6CCC....
...C6CCCCC6CC...
..CCC2C6CCC2CC..
..CCCCCCCCCCCC..
................
................
................
................
................
................
................
................`]
)

setSolids([player])

let level = 0
const levels = [
  map`
.....
.....
.....
.....
..p..`
]

setMap(levels[level])

setPushables({
  [ player ]: []
})

let collectedFood = [];

onInput("a", () => {
  getFirst(player).x -= 1
  
  collectedFood.forEach((food) => {
    food.x = getFirst(player).x
  })
})

onInput("d", () => {
  getFirst(player).x += 1
  
  collectedFood.forEach((food) => {
    food.x = getFirst(player).x
  })
})

const foodTypes = [meat, cheese, tomato, lettuce, topBun];

function randFood() {
  let num = Math.floor(Math.random() * 5);
  return foodTypes[num];
}

let foods = [];

function addFood() {
  let x = Math.floor(Math.random() * 5);
  let y = 0;
  let newFood = addSprite(x, y, randFood());
  foods.push(newFood);
}

function fallingFood() {
  foodTypes.forEach(type => {
    getAll(type).forEach(food => {
      food.y += 1
    }) 
  })
}

function removeFood() {
  foodTypes.forEach(type => {
    getAll(type).forEach(food => {
      if (food.y == 4) {
        let x = food.x;
        let y = food.y;
        food.remove();
        clearTile(x, y);
      }
    })
  })
}

function stackingFood() {
  foodTypes.forEach(type => {
    getAll(type).forEach(food => {
      if (food.x === getFirst(player).x && food.y === getFirst(player).y) {
        collectedFood.push(food)
      }
    })
  })
}

var runGame = setInterval(() => {
  addFood();
  fallingFood();
  removeFood();
}, 1000);
